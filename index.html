<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quem √© a Pessoa?</title>
    <!-- Carrega o Tailwind CSS para estiliza√ß√£o moderna e responsiva -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Carrega as bibliotecas do React, ReactDOM e Babel (para compila√ß√£o em tempo real) -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Configura√ß√£o do Tailwind para usar a fonte Inter -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #0f172a; /* Cor de fundo do jogo */
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Importa√ß√µes do Lucide foram removidas e substitu√≠das por Emojis para compatibilidade com o CDN/Babel
        const { useState, useEffect } = React;

        // Fun√ß√£o utilit√°ria para embaralhar um array (Fisher-Yates)
        const shuffleArray = (array) => {
            let newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        };

        const CELEBRITIES = [
          {
            id: 1,
            name: "Marc√£o",
            acceptedNames: ["marcos freitas", "marc√£o", "marcao", "marcos"],
            image: "https://lh3.googleusercontent.com/a-/ALV-UjXyxhWM8XavKujMP816Uimbg9m1zAj6r15Z6I0gvWkR-uWFJ8wh=s75-c",
            hint: "Professor de biologia/ci√™ncias."
          },
          {
            id: 2,
            name: "Mirna",
            acceptedNames: ["mirna", "mirna auly grande", "mirna auly"],
            image: "https://lh3.googleusercontent.com/a-/ALV-UjXbVbJROsAPeLxGeRyTygexVSGLkIUGztyeGcVyaZc7F6Xit9IQ=s75-c",
            hint: "Professora de hist√≥ria"
          },
          {
            id: 3,
            name: "M√°rio",
            acceptedNames: ["mario", "m√°rio", "mario sergio"],
            image: "https://lh3.googleusercontent.com/a-/ALV-UjWo82zIHNZUfURt-Ow5gE9Q4hB8Z2XIGiBsldpJevD__kdn4ew=s75-c",
            hint: "Professor de filosofia"
          },
          {
            id: 4,
            name: "Miguel Angelo",
            acceptedNames: ["miguel angelo", "miguel", "diretor miguel", "diretor miguel angelo"],
            image: "https://lh3.googleusercontent.com/a-/ALV-UjVQzbIL9-1dH6R6-JFP7-wzDInsy-H3zh6dluufRRr0LyA3bN8=s75-c",
            hint: "Professor de educa√ß√£o f√≠sica."
          },
          {
            id: 5,
            name: "Carina",
            acceptedNames: ["carina", "carina chulek"],
            image: "https://lh3.googleusercontent.com/a-/ALV-UjVKTypkG3gd3N8-I0ywo138txq2Nnfa8EHHhIYSh9Q0ylvYHH64=s75-c",
            hint: "Professora de matem√°tica"
          },
          {
            id: 6,
            name: "Ademar",
            acceptedNames: ["ademar", "ademar socoloski"],
            image: "https://lh3.googleusercontent.com/a-/ALV-UjWZE4AHXYdoKwPIuBNvLsVKc4DpTWrQLo7E_A5MhoPft7ZDyH4=s75-c",
            hint: "Professor de geografia"
          }
        ];

        const MAX_ATTEMPTS = 4;
        const INITIAL_REVEAL_PERCENT = 4; // Come√ßa min√∫sculo (4%)
        const REVEAL_INCREMENT = 4; // Cresce quase nada a cada erro (4%)

        function App() {
          const [currentCeleb, setCurrentCeleb] = useState(null);
          const [guess, setGuess] = useState("");
          const [attemptsLeft, setAttemptsLeft] = useState(MAX_ATTEMPTS);
          const [gameState, setGameState] = useState('playing'); // playing, won, lost
          const [message, setMessage] = useState("");
          const [showHint, setShowHint] = useState(false);
          const [isImageLoading, setIsImageLoading] = useState(false); 
          
          // Novos estados para controle de sequ√™ncia
          const [shuffledCelebrities, setShuffledCelebrities] = useState([]);
          const [currentIndex, setCurrentIndex] = useState(0);
          const [gameFinished, setGameFinished] = useState(false); 

          // Fun√ß√£o para iniciar uma nova Pessoa
          const startNewCelebrity = (celebToLoad) => {
            if (!celebToLoad) {
                setIsImageLoading(false);
                return;
            }
            
            setIsImageLoading(true);
            setCurrentCeleb(celebToLoad);
            setGuess("");
            setAttemptsLeft(MAX_ATTEMPTS);
            setGameState('playing');
            setMessage("");
            setShowHint(false);

            // --- L√ìGICA DE CARREGAMENTO FOR√áADO ---
            const imageLoadPromise = new Promise((resolve) => {
                const newImage = new Image();
                newImage.onload = resolve;
                newImage.onerror = resolve; // Resolve mesmo em caso de erro para n√£o travar
                newImage.src = celebToLoad.image;
            });

            const minTimePromise = new Promise(resolve => setTimeout(resolve, 500));

            Promise.all([imageLoadPromise, minTimePromise]).then(() => {
                setIsImageLoading(false);
            });
          };

          // Inicia o jogo ou avan√ßa para a pr√≥xima Pessoa
          useEffect(() => {
            // 1. Inicializa ou Reshuffle
            if (shuffledCelebrities.length === 0) {
                // Embaralha o array de Pessoas na montagem inicial
                setShuffledCelebrities(shuffleArray(CELEBRITIES));
                return;
            }

            // 2. Verifica se o jogo acabou (todas as Pessoas foram mostradas)
            if (currentIndex >= shuffledCelebrities.length) {
                if (shuffledCelebrities.length > 0) {
                    setGameFinished(true);
                }
                return;
            }

            // 3. Carrega a Pessoa no √≠ndice atual
            const celebToLoad = shuffledCelebrities[currentIndex];
            if (celebToLoad) {
                startNewCelebrity(celebToLoad);
            }
            
          }, [currentIndex, shuffledCelebrities.length]);
          
          // Tratamento para o primeiro carregamento (currentCeleb √© null)
          // Se currentCeleb for null e shuffledCelebrities j√° estiver carregado, o useEffect acima far√° o primeiro startNewCelebrity.

          // C√°lculo do raio do c√≠rculo n√≠tido
          const getRevealRadius = () => {
            if (gameState === 'won' || gameState === 'lost') return 150;
            const errorsMade = MAX_ATTEMPTS - attemptsLeft;
            return INITIAL_REVEAL_PERCENT + (errorsMade * REVEAL_INCREMENT);
          };

          const currentRadius = getRevealRadius();

          const handleGuess = (e) => {
            e.preventDefault();
            if (gameState !== 'playing' || !guess.trim()) return;

            const normalizedGuess = guess.toLowerCase().trim();
            
            // Verifica se o palpite est√° correto
            if (currentCeleb.acceptedNames.includes(normalizedGuess)) {
              setGameState('won');
              setMessage(`Parab√©ns! √â ${currentCeleb.name}!`);
            } else {
              const newAttempts = attemptsLeft - 1;
              setAttemptsLeft(newAttempts);
              setGuess("");
              
              if (newAttempts === 0) {
                setGameState('lost');
                setMessage(`Game Over! Era ${currentCeleb.name}.`);
              } else {
                setMessage("Errou! O foco aumentou s√≥ um pouquinho...");
                
                // Limpa a mensagem ap√≥s 2 segundos, mas apenas se o estado for 'playing'
                setTimeout(() => {
                    if (gameState === 'playing') setMessage(""); 
                }, 2000);
              }
            }
          };

          // Avan√ßa para a pr√≥xima Pessoa ap√≥s vit√≥ria/derrota/skip
          const handleNextCelebrity = () => {
            setGameState('playing'); // Reset state momentarily to ensure the index update works
            setCurrentIndex(prevIndex => prevIndex + 1);
            setGuess("");
            setMessage("Carregando...");
          };

          const handleSkip = () => {
            if (gameState !== 'playing') return;
            setMessage("Pulando para a pr√≥xima Pessoa...");
            setTimeout(() => {
                handleNextCelebrity();
            }, 500);
          };
          
          // L√≥gica para reiniciar o jogo
          const restartGame = () => {
              setGameFinished(false);
              setCurrentIndex(0);
              setShuffledCelebrities(shuffleArray(CELEBRITIES)); // Embaralha novamente
          };


          // Exibe a tela de Jogo Conclu√≠do
          if (gameFinished) {
              return (
                  <div className="min-h-screen bg-slate-900 flex flex-col items-center justify-center py-10 px-4 font-sans text-slate-100">
                      <div className="w-full max-w-md bg-slate-800 p-8 rounded-2xl shadow-2xl border border-slate-700 text-center">
                          <h2 className="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-cyan-400 mb-4">
                              üèÜ Jogo Conclu√≠do! üèÜ
                          </h2>
                          <p className="text-slate-300 mb-6">
                              Voc√™ chegou ao fim da lista de Pessoas desta rodada!
                          </p>
                          <button 
                              onClick={restartGame}
                              className="w-full py-3 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 rounded-xl font-bold shadow-lg transform active:scale-95 transition-all"
                          >
                              Iniciar Nova Rodada (Embaralhar)
                          </button>
                      </div>
                  </div>
              );
          }


          // Garante que a tela de carregamento s√≥ aparece se n√£o houver Pessoa carregada
          if (!currentCeleb) return <div className="min-h-screen bg-slate-900 flex items-center justify-center text-white">Carregando...</div>;

          return (
            <div className="min-h-screen bg-slate-900 flex flex-col items-center py-10 px-4 font-sans text-slate-100">
              
              {/* Header */}
              <header className="mb-8 text-center">
                <h1 className="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600 mb-2">
                  Quem √© a Pessoa?
                </h1>
              </header>

              {/* Main Game Card */}
              <div className="w-full max-w-md bg-slate-800 rounded-2xl shadow-2xl overflow-hidden border border-slate-700">
                
                {/* Progress Bar */}
                <div className="w-full bg-slate-700 h-2">
                  <div 
                    className={`h-full transition-all duration-500 ${attemptsLeft <= 2 ? 'bg-red-500' : 'bg-green-500'}`}
                    style={{ width: `${(attemptsLeft / MAX_ATTEMPTS) * 100}%` }}
                  ></div>
                </div>

                <div className="p-6 flex flex-col items-center">
                  
                  {/* Status Badge */}
                  <div className="flex justify-between w-full mb-4 text-sm font-semibold">
                    <span className={`px-3 py-1 rounded-full ${attemptsLeft <= 2 ? 'bg-red-500/20 text-red-300' : 'bg-green-500/20 text-green-300'}`}>
                      Tentativas: {attemptsLeft}
                    </span>
                    <span className="text-slate-400 flex items-center gap-1">
                      üì∑ Foco: {currentRadius}%
                    </span>
                  </div>

                  {/* Image Container with "Magic Eye" Effect */}
                  <div className="relative w-64 h-64 mb-6 rounded-lg overflow-hidden border-4 border-slate-600 shadow-inner bg-black group">
                    
                    {/* Overlay de carregamento com Spinner animado */}
                    {isImageLoading && (
                        <div className="absolute inset-0 z-30 flex items-center justify-center bg-black text-purple-400 font-bold">
                            <div className="flex flex-col items-center">
                                {/* Spinner Tailwind CSS */}
                                <div className="w-12 h-12 border-4 border-t-4 border-purple-500 border-opacity-25 rounded-full animate-spin mb-2"></div>
                                <span>Carregando Nova Pessoa...</span>
                            </div>
                        </div>
                    )}
                    
                    {/* Camada 1: Imagem totalmente borrada (Fundo) */}
                    <img 
                      src={currentCeleb.image} 
                      onError={(e) => { e.target.onerror = null; e.target.src="https://placehold.co/640x640/1f2937/d1d5db?text=Erro+Imagem"; }}
                      alt="Pessoa Borrada"
                      className="absolute inset-0 w-full h-full object-cover"
                      style={{ filter: 'blur(20px)', transform: 'scale(1.1)' }} 
                    />

                    {/* Camada 2: Imagem N√≠tida com Recorte Circular (Frente) */}
                    <img 
                      src={currentCeleb.image} 
                      onError={(e) => { e.target.onerror = null; e.target.src="https://placehold.co/640x640/1f2937/d1d5db?text=Erro+Imagem"; }}
                      alt="Pessoa N√≠tida"
                      className="absolute inset-0 w-full h-full object-cover transition-all duration-700 ease-out"
                      style={{ 
                        clipPath: `circle(${currentRadius}% at 50% 50%)`,
                        zIndex: 10
                      }}
                    />
                    
                    {/* Overlay for Game Over/Win */}
                    {gameState !== 'playing' && (
                      <div className="absolute inset-0 flex items-center justify-center bg-black/40 backdrop-blur-[2px] animate-in fade-in z-20">
                        {gameState === 'won' ? (
                          <span className="text-7xl drop-shadow-lg">‚úÖ</span> // CheckCircle replaced
                        ) : (
                          <span className="text-7xl drop-shadow-lg">‚ùå</span> // AlertCircle replaced
                        )}
                      </div>
                    )}
                  </div>

                  {/* Feedback Message */}
                  <div className={`h-8 mb-4 text-center font-medium ${gameState === 'won' ? 'text-green-400' : gameState === 'lost' ? 'text-red-400' : 'text-yellow-400'}`}>
                    {message}
                  </div>

                  {/* Input Area */}
                  {gameState === 'playing' ? (
                    <div className="w-full space-y-4">
                      <form onSubmit={handleGuess} className="relative">
                        <input
                          type="text"
                          value={guess}
                          onChange={(e) => setGuess(e.target.value)}
                          placeholder="Digite o nome..."
                          className="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 text-white placeholder-slate-400 transition-all"
                          autoFocus
                          disabled={isImageLoading}
                        />
                      </form>
                      
                      <div className="flex gap-2">
                        <button 
                          onClick={handleGuess}
                          disabled={!guess.trim() || isImageLoading}
                          className="flex-1 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 rounded-xl font-bold shadow-lg transform active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                          Adivinhar
                        </button>
                      </div>
                    </div>
                  ) : (
                    // Bot√£o para a pr√≥xima Pessoa ap√≥s Vitoria/Derrota
                    <button 
                      onClick={handleNextCelebrity}
                      className="w-full py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-bold flex items-center justify-center gap-2 transition-all"
                    >
                      {currentIndex < shuffledCelebrities.length ? '‚û°Ô∏è Pr√≥xima Pessoa' : 'üéâ Ver Pontua√ß√£o Final'}
                    </button>
                  )}

                  {/* Hint Area */}
                  <div className="mt-6 w-full pt-4 border-t border-slate-700">
                    {gameState === 'playing' && (
                      <div className="text-center">
                        {!showHint ? (
                          <button 
                            onClick={() => setShowHint(true)}
                            disabled={isImageLoading}
                            className="text-sm text-slate-400 hover:text-purple-400 flex items-center justify-center gap-1 mx-auto transition-colors disabled:opacity-50"
                          >
                            ‚ùì Precisa de uma dica?
                          </button>
                        ) : (
                          <div className="bg-slate-700/50 p-3 rounded-lg animate-in fade-in slide-in-from-bottom-2">
                            <p className="text-sm text-purple-300 italic">
                              üí° Dica: {currentCeleb.hint}
                            </p>
                          </div>
                        )}
                      </div>
                    )}
                    
                    {gameState !== 'playing' && (
                      <div className="text-center text-slate-400 text-sm">
                        A resposta era: <span className="text-white font-bold">{currentCeleb.name}</span>
                      </div>
                    )}
                  </div>

                </div>
              </div>
              
              <footer className="mt-8 text-slate-500 text-xs text-center">
                Imagens Autorizadas Pelos Professores/Funcion√°rios.<br/>
                Pessoas da Escola
              </footer>
            </div>
          );
        }

        // Renderiza o componente App
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>